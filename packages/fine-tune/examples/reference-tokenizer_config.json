{
  "additional_special_tokens": null,
  "backend": "tokenizers",
  "boi_token": "<start_of_image>",
  "bos_token": "<bos>",
  "clean_up_tokenization_spaces": false,
  "eoi_token": "<end_of_image>",
  "eos_token": "<eos>",
  "image_token": "<image_soft_token>",
  "is_local": false,
  "mask_token": "<mask>",
  "model_max_length": 1000000000000000019884624838656,
  "model_specific_special_tokens": {
    "boi_token": "<start_of_image>",
    "eoi_token": "<end_of_image>",
    "image_token": "<image_soft_token>",
    "sfr_token": "<start_function_response>"
  },
  "pad_token": "<pad>",
  "padding_side": "left",
  "sfr_token": "<start_function_response>",
  "sp_model_kwargs": null,
  "spaces_between_special_tokens": false,
  "tokenizer_class": "GemmaTokenizer",
  "unk_token": "<unk>",
  "use_default_system_prompt": false,
  "chat_template": "{%- macro format_parameters(properties, required) -%}\n    {%- set standard_keys = ['description', 'type', 'properties', 'required', 'nullable'] -%}\n    {%- set ns = namespace(found_first=false) -%}\n    {%- for key, value in properties | dictsort -%}\n        {%- if key not in standard_keys -%}\n            {%- if ns.found_first %},{% endif -%}\n            {%- set ns.found_first = true -%}\n            {{- key }}:{description:<escape>{{ value['description'] }}<escape>\n            {%- if value['type'] | upper == 'STRING' -%}\n                {%- if value['enum'] -%}\n                    ,enum:{{ format_argument(value['enum']) }}\n                {%- endif -%}\n            {%- elif value['type'] | upper == 'OBJECT' -%}\n                ,properties:{\n                {%- if value['properties'] is defined and value['properties'] is mapping -%}\n                    {{- format_parameters(value['properties'], value['required'] | default([])) -}}\n                {%- elif value is mapping -%}\n                    {{- format_parameters(value, value['required'] | default([])) -}}\n                {%- endif -%}\n                }\n                {%- if value['required'] -%}\n                    ,required:[\n                    {%- for item in value['required'] | default([]) -%}\n                        <escape>{{- item -}}<escape>\n                        {%- if not loop.last %},{% endif -%}\n                    {%- endfor -%}\n                    ]\n                {%- endif -%}\n            {%- elif value['type'] | upper == 'ARRAY' -%}\n                {%- if value['items'] is mapping and value['items'] -%}\n                    ,items:{\n                    {%- set ns_items = namespace(found_first=false) -%}\n                    {%- for item_key, item_value in value['items'] | dictsort -%}\n                        {%- if item_value is not none -%}\n                            {%- if ns_items.found_first %},{% endif -%}\n                            {%- set ns_items.found_first = true -%}\n                            {%- if item_key == 'properties' -%}\n                                properties:{\n                                {%- if item_value is mapping -%}\n                                    {{- format_parameters(item_value, value['items']['required'] | default([])) -}}\n                                {%- endif -%}\n                                }\n                            {%- elif item_key == 'required' -%}\n                                required:[\n                                {%- for req_item in item_value -%}\n                                    <escape>{{- req_item -}}<escape>\n                                    {%- if not loop.last %},{% endif -%}\n                                {%- endfor -%}\n                                ]\n                            {%- elif item_key == 'type' -%}\n                                {%- if item_value is string -%}\n                                    type:{{ format_argument(item_value | upper) }}\n                                {%- else -%}\n                                    type:{{ format_argument(item_value | map('upper') | list) }}\n                                {%- endif -%}\n                            {%- else -%}\n                                {{ item_key }}:{{ format_argument(item_value) }}\n                            {%- endif -%}\n                        {%- endif -%}\n                    {%- endfor -%}\n                    }\n                {%- endif -%}\n            {%- endif -%}\n            ,type:<escape>{{ value['type'] | upper }}<escape>}\n        {%- endif -%}\n    {%- endfor -%}\n{%- endmacro -%}\n{% macro format_function_declaration(tool_data) -%}\ndeclaration:{{- tool_data['function']['name'] -}}\n{description:<escape>{{- tool_data['function']['description'] -}}<escape>\n{%- set params = tool_data['function']['parameters'] -%}\n{%- if params -%}\n    ,parameters:{\n    {%- if params['properties'] -%}\n        properties:{ {{- format_parameters(params['properties'], params['required']) -}} },\n    {%- endif -%}\n    {%- if params['required'] -%}\n        required:[\n        {%- for item in params['required'] -%}\n            <escape>{{- item -}}<escape>\n            {{- ',' if not loop.last -}}\n        {%- endfor -%}\n        ],\n    {%- endif -%}\n    {%- if params['type'] -%}\n        type:<escape>{{- params['type'] | upper -}}<escape>}\n    {%- endif -%}\n{%- endif -%}\n}\n{%- endmacro -%}\n{% macro format_argument(argument, escape_keys=True) -%}\n{%- if argument is string -%}\n    {{- '<escape>' + argument + '<escape>' -}}\n{%- elif argument is boolean -%}\n    {%- if argument -%}\n        {{- 'true' -}}\n    {%- else -%}\n        {{- 'false' -}}\n    {%- endif -%}\n{%- elif argument is mapping -%}\n    {{- '{' -}}\n    {%- set ns = namespace(found_first=false) -%}\n    {%- for key, value in argument | dictsort -%}\n        {%- if ns.found_first %},{% endif -%}\n        {%- set ns.found_first = true -%}\n        {%- if escape_keys -%}\n            {{- '<escape>' + key + '<escape>' -}}\n        {%- else -%}\n            {{- key -}}\n        {%- endif -%}\n        :{{- format_argument(value, escape_keys=escape_keys) -}}\n    {%- endfor -%}\n    {{- '}' -}}\n{%- elif argument is iterable -%}\n    {{- '[' -}}\n    {%- for item in argument -%}\n        {{- format_argument(item, escape_keys=escape_keys) -}}\n        {%- if not loop.last %},{% endif -%}\n    {%- endfor -%}\n    {{- ']' -}}\n{%- else -%}\n    {{- argument -}}\n{%- endif -%}\n{%- endmacro -%}\n{{ bos_token }}\n{%- set ns = namespace(prev_message_type=None) -%}\n{#- Tool Declarations -#}\n{%- set loop_messages = messages -%}\n{%- if tools or messages[0]['role'] == 'system' or messages[0]['role'] == 'developer' -%}\n    {{- '<start_of_turn>developer\\n' -}}\n    {%- if messages[0]['role'] == 'system' or messages[0]['role'] == 'developer' -%}\n        {%- if messages[0]['content'] is string -%}\n            {{- messages[0]['content'] | trim -}}\n        {%- elif messages[0]['content'] is iterable -%}\n            {%- for item in messages[0]['content'] -%}\n                {%- if item['type'] == 'text' -%}\n                    {{- item['text'] | trim -}}\n                {%- endif -%}\n            {%- endfor -%}\n        {%- endif -%}\n        {%- set loop_messages = messages[1:] -%}\n    {%- endif -%}\n    {%- if tools -%}\n        {%- for tool in tools %}\n            {{- '<start_function_declaration>' -}}\n            {{- format_function_declaration(tool) | trim }}\n            {{- '<end_function_declaration>' -}}\n        {%- endfor %}\n    {%- endif -%}\n    {{- '<end_of_turn>\\n' }}\n{%- endif %}\n{#- Loop through messages. -#}\n{%- for message in loop_messages -%}\n    {%- if (message['role'] == 'assistant') -%}\n        {#- Rename \"assistant\" to \"model\". -#}\n        {%- set role = \"model\" -%}\n    {%- else -%}\n        {%- set role = message['role'] -%}\n    {%- endif -%}\n    {%- if role != 'tool' -%}\n        {%- if ns.prev_message_type != 'tool_response' -%}\n            {{- '<start_of_turn>' + role + '\\n' }}\n        {%- endif -%}\n        {%- set ns.prev_message_type = None -%}\n        {%- if 'content' in message and message['content'] is not none -%}\n            {%- if message['content'] is string -%}\n                {{ message['content'] | trim }}\n            {%- elif message['content'] is iterable -%}\n                {%- for item in message['content'] -%}\n                    {%- if item['type'] == 'image' -%}\n                        {{ '<start_of_image>' }}\n                    {%- elif item['type'] == 'text' -%}\n                        {{ item['text'] | trim }}\n                    {%- endif -%}\n                {%- endfor -%}\n            {%- else -%}\n                {{ raise_exception(\"Invalid content type in user/assistant message\") }}\n            {%- endif -%}\n            {%- set ns.prev_message_type = 'content' -%}\n        {%- endif -%}\n        {%- if 'tool_calls' in message and message['tool_calls'] and message['tool_calls'] is iterable -%}\n            {#- Tool Calls -#}\n            {%- for tool_call in message['tool_calls'] -%}\n                {% set function = tool_call['function'] %}\n                {{-  '<start_function_call>call:' + function['name'] + '{' -}}\n                {%- if 'arguments' in function -%}\n                    {%- if function['arguments'] is mapping -%}\n                        {%- set ns = namespace(found_first=false) -%}\n                        {%- for key, value in function['arguments'] | dictsort -%}\n                            {%- if ns.found_first %},{% endif -%}\n                            {%- set ns.found_first = true -%}\n                            {{- key -}}:{{- format_argument(value, escape_keys=False) -}}\n                        {%- endfor -%}\n                    {%- elif function['arguments'] is string -%}\n                        {# This handles string-JSON, just in case #}\n                    {{ function['arguments'] }}\n                    {%- endif %}\n                {%- endif -%}\n                {{- '}<end_function_call>' -}}\n            {%- endfor -%}\n            {%- if loop.last -%}\n                {{ '<start_function_response>' }}\n            {%- endif -%}\n            {%- set ns.prev_message_type = 'tool_call' -%}\n        {%- endif -%}\n    {%- else -%}\n        {#- Tool Responses -#}\n        {%- if 'content' in message and message['content'] -%}\n            {%- if message['content'] is mapping -%}\n                {%- if 'name' in message['content'] and 'response' in message['content'] -%}\n                    {{ '<start_function_response>response:' + message['content']['name'] | trim + '{' }}\n                    {%- set response_ns = namespace(found_first=false) -%}\n                    {%- for key, value in message['content']['response'] | dictsort -%}\n                        {%- if response_ns.found_first %},{% endif -%}\n                        {%- set response_ns.found_first = true -%}\n                        {{- key -}}:{{- format_argument(value, escape_keys=False) -}}\n                    {%- endfor -%}\n                    {{- '}<end_function_response>' -}}\n                {%- elif 'name' in message -%}\n                    {{ '<start_function_response>response:' + message['name'] | trim + '{' }}\n                    {%- set response_ns = namespace(found_first=false) -%}\n                    {%- for key, value in message['content'] | dictsort -%}\n                        {%- if response_ns.found_first %},{% endif -%}\n                        {%- set response_ns.found_first = true -%}\n                        {{- key -}}:{{- format_argument(value, escape_keys=False) -}}\n                    {%- endfor -%}\n                    {{- '}<end_function_response>' -}}\n                {%- else -%}\n                    {{ raise_exception(\"Invalid tool response mapping: must contain 'name' and 'response' keys, or 'name' must be in the message.\") }}\n                {%- endif -%}\n            {%- elif message['content'] is string -%}\n                {%- if 'name' in message -%}\n                     {{ '<start_function_response>response:' + message['name'] | trim + '{value:' + format_argument(message['content'], escape_keys=False) + '}<end_function_response>' }}\n                {%- else -%}\n                     {{ raise_exception(\"Invalid tool response: 'name' must be provided.\") }}\n                {%- endif -%}\n            {%- elif message['content'] is iterable -%}\n                {%- for item in message['content'] -%}\n                    {%- if item is mapping -%}\n                        {%- if 'name' in item and 'response' in item -%}\n                            {{ '<start_function_response>response:' + item['name'] | trim + '{' }}\n                            {%- set response_ns = namespace(found_first=false) -%}\n                            {%- for key, value in item['response'] | dictsort -%}\n                                {%- if response_ns.found_first %},{% endif -%}\n                                {%- set response_ns.found_first = true -%}\n                                {{- key -}}:{{- format_argument(value, escape_keys=False) -}}\n                            {%- endfor -%}\n                            {{- '}<end_function_response>' -}}\n                        {%- elif 'name' in message -%}\n                            {{ '<start_function_response>response:' + message['name'] | trim + '{' }}\n                            {%- set response_ns = namespace(found_first=false) -%}\n                            {%- for key, value in item | dictsort -%}\n                                {%- if response_ns.found_first %},{% endif -%}\n                                {%- set response_ns.found_first = true -%}\n                                {{- key -}}:{{- format_argument(value, escape_keys=False) -}}\n                            {%- endfor -%}\n                            {{- '}<end_function_response>' -}}\n                        {%- else -%}\n                            {{ raise_exception(\"Invalid tool response mapping: must contain 'name' and 'response' keys, or 'name' must be in the message.\") }}\n                        {%- endif -%}\n                    {%- else -%}\n                        {{ raise_exception(\"Invalid tool response message: multiple responses must all be mappings\") }}\n                    {%- endif -%}\n                {%- endfor -%}\n            {%- else -%}\n                {{ raise_exception(\"Invalid content type in tool message: must be mapping, sequence of mappings, or string.\") }}\n            {%- endif -%}\n        {%- endif -%}\n        {%- set ns.prev_message_type = 'tool_response' -%}\n    {%- endif -%}\n    {%- if ns.prev_message_type not in ['tool_call', 'tool_response'] -%}\n        {{ '<end_of_turn>\\n' }}\n    {%- endif -%}\n{%- endfor -%}\n{%- if add_generation_prompt -%}\n    {%- if ns.prev_message_type != 'tool_response' -%}\n        {{- '<start_of_turn>model\\n' -}}\n    {%- endif -%}\n{%- endif -%}\n"
}